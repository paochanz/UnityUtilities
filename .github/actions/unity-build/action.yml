name: unity-build
description: 'https://game.ci/docs/github/getting-started'
runs:
  using: "composite"
  steps:
    - name: checkout-project
      uses: actions/checkout@v4
      with:
        repository: paochanz/${{ env.PROJECT_NAME }}
        fetch-depth: 1
    - name: add-swap-16gb
      shell: bash
      run: |
        set -eux
        free -h
        df -h /
        sudo fallocate -l 16G /swapfile || sudo dd if=/dev/zero of=/swapfile bs=1M count=16384
        sudo chmod 600 /swapfile
        sudo mkswap /swapfile
        sudo swapon /swapfile
        echo 'vm.swappiness=10' | sudo tee -a /etc/sysctl.conf
        sudo sysctl -p || true
        free -h
        swapon --show
    - name: build
      uses: game-ci/unity-builder@v4
      with:
        projectPath: ${{ env.PROJECT_PATH }}
        targetPlatform: ${{ env.target_platform }}
        buildName: ${{ env.PROJECT_NAME }}
        customImage: ${{ env.unity_custom_image }}
        customParameters: |
          -job-worker-count 2
        versioning: 'None'
    - name: upload
      uses: actions/upload-artifact@v4
      with:
        name: ${{ env.target_platform }}-${{ env.PROJECT_NAME }}
        path: build/${{ env.target_platform }}
        retention-days: 1
